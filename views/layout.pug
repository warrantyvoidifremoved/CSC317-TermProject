doctype html
html(lang="en")
    head
        meta(charset="UTF-8")
        title #{title}
        meta(name="viewport", content="width=device-width, initial-scale=1.0")
        link(rel="stylesheet", href="/css/layout-desktop.css")
        link(rel="icon" type="image/png" href="/images/favicon.png")
        link(rel="icon" type="image/png" sizes="64x64" href="/images/favicon/favicon-64x64.png")
        link(rel="icon" type="image/png" sizes="128x128" href="/images/favicon/favicon-128x128.png")
        link(rel="icon" type="image/png" sizes="256x256" href="/images/favicon/favicon-256x256.png")

        block stylesheets
    body
        nav#navbar
            div#title
                a(href="/") Rocks!
            ul#nav-links
                li.search-container
                    form(name="search", action="/search", method="GET")
                        input(type="text", name="q")
                        button(type="submit")
                li
                    a(href="/") Products ▾
                    ul#nav-products
                        li: a(href="/products/categories/igneous") Igneous
                        li: a(href="/products/categories/sedimentary") Sedimentary
                        li: a(href="/products/categories/metamorphic") Metamorphic
                li: a(href="/about") About
                li: a(href="/faq") FAQ
                li
                    a(href="#")
                        img.nav-img(src="/images/nav/user.png", alt="User Profile")
                    ul#profile-options
                        if !user
                            li: a(href="/login") Log In
                            li: a(href="/signup") Sign Up
                        else
                            li: a(href="/user") Profile
                            li: form(action="/logout", method="POST")
                                button(type="submit" class="logout-link") Log Out
                li: a(href="/cart")
                    img.nav-img#cart(src="/images/nav/shopping-cart.png", alt="Shopping Cart")
        block content
        footer
            #footer
                #SFSU © 2025 San Francisco State University - Introduction to Web Software Development
                .social-media
                    a(href="/x", target="_blank")
                        img#X(src="/images/social_media/X-logo.png", alt="X Logo")
                    a(href="/instagram", target="_blank")
                        img#instagram(src="/images/social_media/Instagram-logo.png", alt="Instagram Logo")
                    a(href="/discord", target="_blank")
                        img#discord(src="/images/social_media/Discord-logo.png", alt="Discord Logo")
        block scripts
        script.
    document.addEventListener('DOMContentLoaded', function() {
      // Check if on mobile
      const isMobile = window.innerWidth <= 768;
      
      if (isMobile) {
        // Get all dropdown trigger elements
        const productsTrigger = document.querySelector('#nav-links li:nth-child(2)');
        const profileTrigger = document.querySelector('#nav-links li:nth-child(5)');
        
        // Add click event for Products dropdown
        if (productsTrigger) {
          productsTrigger.addEventListener('click', function(e) {
            // Only prevent default if clicking the direct link
            if (e.target === this.querySelector('a')) {
              e.preventDefault();
            }
            
            // Remove active class from other dropdowns
            if (profileTrigger) {
              profileTrigger.classList.remove('active');
            }
            
            // Toggle active class for current dropdown
            this.classList.toggle('active');
            
            e.stopPropagation(); // Prevent document click from immediately closing
          });
        }
        
        // Add click event for Profile dropdown
        if (profileTrigger) {
          profileTrigger.addEventListener('click', function(e) {
            // Only prevent default if clicking the direct link
            if (e.target === this.querySelector('a')) {
              e.preventDefault();
            }
            
            // Remove active class from other dropdowns
            if (productsTrigger) {
              productsTrigger.classList.remove('active');
            }
            
            // Toggle active class for current dropdown
            this.classList.toggle('active');
            
            e.stopPropagation(); // Prevent document click from immediately closing
          });
        }
        
        // Close dropdowns when clicking elsewhere
        document.addEventListener('click', function(e) {
          if (!e.target.closest('#nav-links li.active')) {
            if (productsTrigger) {
              productsTrigger.classList.remove('active');
            }
            if (profileTrigger) {
              profileTrigger.classList.remove('active');
            }
          }
        });
        
        // Allow dropdown links to work
        const dropdownLinks = document.querySelectorAll('#nav-products a, #profile-options a');
        dropdownLinks.forEach(link => {
          link.addEventListener('click', function(e) {
            e.stopPropagation(); // Let the link navigate without being prevented
          });
        });
      }
      
      // Add resize event to handle switching between mobile and desktop
      window.addEventListener('resize', function() {
        const isMobileNow = window.innerWidth <= 768;
        
        // If switched from mobile to desktop, remove active classes
        if (!isMobileNow) {
          const dropdowns = document.querySelectorAll('#nav-links li');
          dropdowns.forEach(dropdown => {
            dropdown.classList.remove('active');
          });
        }
      });
    });